commit 1059757761ceb5a79c34335df0fa9618bd99c56f
Author: asturel <astur3l@gmail.com>
Date:   Tue Sep 18 23:19:32 2012 +0200

    fix wpa_supplicant_signal_poll
    
    Change-Id: I91fbb2881ee48871e8122dc991f34b4257f503e7

diff --git a/wpa_supplicant/ctrl_iface.c b/wpa_supplicant/ctrl_iface.c
index 9b2114b..4725160 100644
--- a/wpa_supplicant/ctrl_iface.c
+++ b/wpa_supplicant/ctrl_iface.c
@@ -1635,7 +1635,7 @@ static int wpa_supplicant_driver_cmd(struct wpa_supplicant *wpa_s,
     }
     return( ret );
 }
-
+/*
 static int wpa_supplicant_signal_poll(struct wpa_supplicant *wpa_s, char *buf,
                                       size_t buflen)
 {
@@ -1655,7 +1655,31 @@ static int wpa_supplicant_signal_poll(struct wpa_supplicant *wpa_s, char *buf,
         return -1;
     return ret;
 }
+*/
+static int wpa_supplicant_signal_poll(struct wpa_supplicant *wpa_s, char *buf,
+                                      size_t buflen)
+{
+    int ret;
+    int lssize=20;
+    int rssisize=250;
+    char linkspeed[lssize];
+    char rssi[rssisize];
 
+
+    wpa_supplicant_driver_cmd(wpa_s, "LINKSPEED", linkspeed, lssize);
+
+    wpa_supplicant_driver_cmd(wpa_s, "RSSI", rssi, rssisize); // wext+bcm4329 format: SSID rssid val \0   >= 16 (we have to trim the space at end)
+
+    ret = os_snprintf(buf, buflen, "RSSI=%d\nLINKSPEED=%s\n"
+            "NOISE=0\nFREQUENCY=0\n",
+            atoi( strcasestr(rssi,"rssi")+5 ),linkspeed+10);
+
+    if (ret < 0 || (unsigned int) ret > buflen)
+        return -1;
+
+
+    return ret;
+}
 #endif
 
 char * wpa_supplicant_ctrl_iface_process(struct wpa_supplicant *wpa_s,
